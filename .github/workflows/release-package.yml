name: Build

on:
  push:
    branches:
      - feature/*
      - dev
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
      with:
        submodules: recursive

    # Set up Emscripten
    - name: Set up Emscripten
      uses: mymindstorm/setup-emsdk@v14

    # Build your project with CMake
    - name: Build
      run: |
        npm run build

    # Upload build artifacts
    - name: Upload build artifacts
      uses: actions/upload-artifact@v2
      with:
        name: build-artifacts
        path: dist

  publish:
    needs: build
    if: github.ref == 'refs/heads/main'
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    - name: Download build artifacts
      uses: actions/download-artifact@v2
      with:
        name: build-artifacts
        path: dist

    # Publish to GitHub Packages (adjust for your packaging tool)
    - name: Publish
      run: |
        # Assuming you're generating a npm package
        npm publish
      env:
        NPM_CONFIG_TOKEN: ${{ secrets.GITHUB_TOKEN }}
