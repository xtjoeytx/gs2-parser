//#CLIENTSIDE
function onCreated() {
  if (player.level != "g_event-grenadefight.nw")
    destroy();
  setTimer(0.05);
}

function onWeaponFired() {
  if (this.nadeout == false) {
    if (this.ttick <= 0) {
      this.nadeout = true;
      this.mthrow = 0.65;
      onTimeout();
    }
    else findWeapon("-Chat").addMsg("Server", "You can only throw one grenade every 2 seconds!", 15);
  }
}

function onTimeout() {
  if (keydown(4)) {
    if (this.nadeout == true && this.mtick <= 0) {
      setani("grab", NULL);
      playerfreeze = 0.05;
      if (this.mthrow < 2.2) {
        this.mtick = 0.05;
        this.mthrow += 0.05;
      }
    }
  }
  elseif (this.nadeout == true)
    onThrowNade();
    
  if (this.ttick > 0) this.ttick -= 0.05;
  if (this.mtick > 0) this.mtick -= 0.05;
  
  if (player.weapon != "Events/Grenade") {
    for (i=0;i<weapons.size();i++) {
      if (weapons[i].name == "Events/Grenade") {
        selectedweapon = i;
      }
    }
  }
  
  setTimer(0.05);
}

function onKeyPressed(keycode, keychar) {
  if (keychar == "F" && this.nadeout == true) {
    this.mthrow = 0;
    onThrowNade();
  }
}

function onThrowNade() {
  if (player.level == "g_event-grenadefight.nw") {
    if (this.ttick <= 0) {
      playerfreeze = 0.45;
      this.ttick = 0.5;
      this.angle = getangle(vecx(player.dir), vecy(player.dir)), 1.57 / 2;
      if (player.guild != NULL) {
        setshootparams(player.account, 15, player.guild, client.nopk, false, "grenade", this.angle, this.mthrow);
      } else {
        setshootparams(player.account, 15, "(none)", client.nopk, false, "grenade", this.angle, this.mthrow); 
     }
      shoot(player.x, player.y, player.z, getangle(vecx(player.dir), vecy(player.dir)), 1.57 / 2, this.mthrow, "gx_grenadetest", NULL);
    }
    else findWeapon("-Chat").addMsg("Server", "You can only throw one grenade every second!", 15);
  }
  else destroy();
  
  this.nadeout = false;
  this.mthrow = 0;
  setTimer(0.05);
}